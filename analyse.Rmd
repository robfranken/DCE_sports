---
title: "Conditional logit model"
bibliography: references.bib
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
output: 
  html_document:
    css: tweaks.css
    toc:  true
    toc_float: true
    number_sections: true
    toc_depth: 1
    code_folding: show
    code_download: yes
---

```{r, globalsettings, echo=FALSE, warning=FALSE, results='hide'}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test3"))
options(width = 100)
rgl::setupKnitr()

colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }
```


```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```


---  


To copy the code, click the button in the upper right corner of the code-chunks.

# Getting started

## clean up

```{r, results='hide'}
rm(list=ls())
gc()
```

<br>

## general custom functions

- `fpackage.check`: Check if packages are installed (and install if not) in R
- `fsave`: Function to save data with time stamp in correct directory
- `fload`: Function to load R-objects under new names

```{r, results='hide', message=FALSE, warning=FALSE}
fpackage.check <- function(packages) {
    lapply(packages, FUN = function(x) {
        if (!require(x, character.only = TRUE)) {
            install.packages(x, dependencies = TRUE)
            library(x, character.only = TRUE)
        }
    })
}

fsave <- function(x, file, location = "./data/processed/", ...) {
    if (!dir.exists(location))
        dir.create(location)
    datename <- substr(gsub("[:-]", "", Sys.time()), 1, 8)
    totalname <- paste(location, datename, file, sep = "")
    print(paste("SAVED: ", totalname, sep = ""))
    save(x, file = totalname)
}


fload  <- function(fileName){
  load(fileName)
  get(ls()[ls() != "fileName"])
}
```

<br>

## necessary packages

- `tidyverse`: data wrangling
- `mlogit`: multinomial logit
- `knitr`: generating tables
- `kableExtra`: manipulating tables

```{r, results='hide', message=FALSE, warning=FALSE}
packages = c("tidyverse", "mlogit", "knitr", "kableExtra")
fpackage.check(packages)
```

<br>

## load in mlogit data
```{r, eval=F}
#get todays date:
today <- gsub("-", "", Sys.Date())

abs_ml <- fload(paste0("./data/processed/",today,"abs_ml.RData"))
io_ml <- fload(paste0("./data/processed/",today,"io_ml.RData"))
rm (today)
```


<br>

# run model {.tabset .tabset-fade}

## Sports & Friendships

```{r, eval=F}
m1 <- mlogit(choice ~ prestatie + kennis + gezellig + esteem | 0, abs_ml)
save(m1,file="./results/abs_m1.RData")
```

```{r,class.source = 'fold-hide'}
ans_abs <- fload("./results/abs_m1.RData")
test <- summary(ans_abs)

res <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
res$vars[1] <- "Comparison: really likes to compare sports performances"
res$vars[2] <- "Comparison: does not like to compare sports performances"

res$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
res$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

res$vars[5] <- "Social: wants a combination of joyful and purposeful training"
res$vars[6] <- "Social: exercises purposefully and seriously"

res$vars[7] <- "Encouragement: sometimes encourages you"
res$vars[8] <- "Encouragement: often encourages you"

names(res)[1] <- ""

knitr::kable(res, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes in 'Sports & Friendships' study") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

## I&O panel
```{r, eval=F}
m1 <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0,io_ml)
save(m1,file="./results/io_m1.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1.RData")
test <- summary(ans_io)

res <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
res$vars[1] <- "Comparison: really likes to compare sports performances"
res$vars[2] <- "Comparison: does not like to compare sports performances"

res$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
res$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

res$vars[5] <- "Social: exercises for fun and enjoyment"
res$vars[6] <- "Social: wants a combination of joyful and purposeful training"

res$vars[7] <- "Encouragement: sometimes encourages you"
res$vars[8] <- "Encouragement: often encourages you"

names(res)[1] <- ""

knitr::kable(res, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```


# {.unlisted .unnumbered}

## observations

1. Comparison: respondents prefer a sports partner who places an appropriate amount of emphasis on social comparison â€” not too much and not too little.

2. Knowledge: respondents don't want a sports partner that knows less about training and technique than themselves. Only in the 'Sports and Friendships' study, we find a significant preference for sports partners that know more.

3. Social: respondents seem to favor someone who combines having fun and being goal-oriented while training; however, they appear to prefer exercising for fun over doing so solely seriously

4: Encouragement: respondents prefer a sports partner that regularly encourages them.


# gender differences {.tabset .tabset-fade}

Test gender interaction quick 'n dirty: subset I&O data by gender and perform separate analyses


## females

```{r, eval=F}
io_ml_f <- io_ml[which(io_ml$female==1),]
mf <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0,io_ml_f)
save(mf,file="./results/io_m1_females.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_females.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among females in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

## males

```{r, eval=F}
io_ml_m <- io_ml[which(io_ml$female==0),]
mm <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0,io_ml_m)
save(mm,file="./results/io_m1_males.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_males.RData")
test <- summary(ans_io)

resm <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resm$vars[1] <- "Comparison: really likes to compare sports performances"
resm$vars[2] <- "Comparison: does not like to compare sports performances"

resm$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resm$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resm$vars[5] <- "Social: exercises for fun and enjoyment"
resm$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resm$vars[7] <- "Encouragement: sometimes encourages you"
resm$vars[8] <- "Encouragement: often encourages you"

names(resm)[1] <- ""

knitr::kable(resm, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among males in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

# {.unlisted .unnumbered}

The one difference is that males dislike a sports partner who *does not like to compare sports performances* compared to a sports partner that somewhat likes to compare sports performance (males estimate: `r resm$Estimate[2]`, females estimate: `r resf$Estimate[2]`). Other than that, preferences for sports partners are rather similar.

