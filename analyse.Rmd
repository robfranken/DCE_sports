---
title: "Conditional logit model"
bibliography: references.bib
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
output: 
  html_document:
    css: tweaks.css
    toc:  true
    toc_float: true
    number_sections: true
    toc_depth: 1
    code_folding: show
    code_download: yes
---

```{r, globalsettings, echo=FALSE, warning=FALSE, results='hide'}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test3"))
options(width = 100)
rgl::setupKnitr()

colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }
```


```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```


---  


To copy the code, click the button in the upper right corner of the code-chunks.

# Getting started

## clean up

```{r, results='hide'}
rm(list=ls())
gc()
```

<br>

## general custom functions

- `fpackage.check`: Check if packages are installed (and install if not) in R
- `fsave`: Function to save data with time stamp in correct directory
- `fload`: Function to load R-objects under new names

```{r, results='hide', message=FALSE, warning=FALSE}
fpackage.check <- function(packages) {
    lapply(packages, FUN = function(x) {
        if (!require(x, character.only = TRUE)) {
            install.packages(x, dependencies = TRUE)
            library(x, character.only = TRUE)
        }
    })
}

fsave <- function(x, file, location = "./data/processed/", ...) {
    if (!dir.exists(location))
        dir.create(location)
    datename <- substr(gsub("[:-]", "", Sys.time()), 1, 8)
    totalname <- paste(location, datename, file, sep = "")
    print(paste("SAVED: ", totalname, sep = ""))
    save(x, file = totalname)
}


fload  <- function(fileName){
  load(fileName)
  get(ls()[ls() != "fileName"])
}
```

<br>

## necessary packages

- `tidyverse`: data wrangling
- `mlogit`: multinomial logit
- `knitr`: generating tables
- `kableExtra`: manipulating tables

```{r, results='hide', message=FALSE, warning=FALSE}
packages = c("tidyverse", "mlogit", "knitr", "kableExtra")
fpackage.check(packages)
```

<br>

## load in mlogit data
```{r, eval=F}
#get todays date:
today <- gsub("-", "", Sys.Date())

io_ml <- fload(paste0("./data/processed/",today,"io_ml.RData"))
rm (today)
```

<br>

# run model

```{r, eval=F}
#main model

class(io_ml)

m1 <- mlogit(choice ~ prestatie + kennis + gezellig + esteem | 0, data = io_ml)
summary(m1)
save(m1,file="./results/io_m1.RData")
```
<br>

## output

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1.RData")
test <- summary(ans_io)

res <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
res$vars[1] <- "Comparison: really likes to compare sports performances"
res$vars[2] <- "Comparison: does not like to compare sports performances"

res$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
res$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

res$vars[5] <- "Social: exercises for fun and enjoyment"
res$vars[6] <- "Social: wants a combination of joyful and purposeful training"

res$vars[7] <- "Encouragement: sometimes encourages you"
res$vars[8] <- "Encouragement: often encourages you"

names(res)[1] <- ""

names(res)[2] <- "Log-odds"

knitr::kable(res, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

<br>

<!----

To-do:

- Present average semi-elasticities for all levels in contrast to the grand mean. Grand mean reflects the decision probability for one of the three sports partners if the respondent has no preferences (thus, a base probability of 1/3, which is set to zero). Accordingly, the positive effect - displayed to the right of the zero line on the x-axis - indicates that people are, on average, more likely to choose a sports partner if they have the respective attribute. And an effect displayed to the left of the zero line indicates people are less likely to choose a sports partner if it has the respective attribute. Whiskers represent 95% confident intervals.

<br>
-->

### observations

1. Comparison: respondents prefer a sports partner who places an appropriate amount of emphasis on social comparison â€” not too much and not too little.

2. Knowledge: respondents don't want a sports partner that knows less about training and technique than themselves. 

3. Social: respondents seem to favor someone who combines having fun and being goal-oriented while training; however, they appear to prefer exercising for fun over doing so solely seriously

4. Encouragement: respondents prefer a sports partner that regularly encourages them.

<br>

----

# subgroup analyses

##  male vs. female {.tabset .tabset-fade}

### males

```{r, eval=F}
io_ml_m <- io_ml[which(io_ml$female==0),]
mm <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_m)
save(mm,file="./results/io_m1_males.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_males.RData")
test <- summary(ans_io)

resm <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resm$vars[1] <- "Comparison: really likes to compare sports performances"
resm$vars[2] <- "Comparison: does not like to compare sports performances"

resm$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resm$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resm$vars[5] <- "Social: exercises for fun and enjoyment"
resm$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resm$vars[7] <- "Encouragement: sometimes encourages you"
resm$vars[8] <- "Encouragement: often encourages you"

names(resm)[1] <- ""
names(res)[2] <- "Log-odds"

knitr::kable(resm, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among males in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### females

```{r, eval=F}
io_ml_f <- io_ml[which(io_ml$female==1),]
mf <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_f)
save(mf,file="./results/io_m1_females.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_females.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""
names(res)[2] <- "Log-odds"

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among females in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```




## {.unlisted .unnumbered}

Both genders won't choose a sports partner who places great emphasis on social comparison and competition. However, males generally prefer a sports partner who places some emphasis on social comparison, whereas females show no significant difference in their preference for a partner who places little or no emphasis on social comparison. In line with the idea that male sports participation is driven to a greater extent by status/competition than females (who were expected to be more driven by affiliation, which is not apparent from the model results).


## currently active {.tabset .tabset-fade}

### yes 

```{r, eval=F}
io_ml_active <- io_ml[which(io_ml$activeW2==1),]
ma <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_active)
save(ma,file="./results/io_m1_actives.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_actives.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""
names(resf)[2] <- "Log-odds"

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among I&O panel respondents who are currently active in sports.") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### no

```{r, eval=F}
io_ml_inactive <- io_ml[which(io_ml$activeW2==0),]
mna <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_inactive)
save(mf,file="./results/io_m1_inactives.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_inactives.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""
names(resf)[2] <- "Log-odds"

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among I&O panel respondents who are currently not active in sports.") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```



## {.unlisted .unnumbered}

Similar pattern: those currently active prefer sports partners who place an appropriate amount of emphasis on social comparison (not too much, not too little). Those currently inactive do not: they dislike great emphasis on social comparison/competition, but do not prefer a little over no emphasis on social comparison. Again, in line with the expectation. Currently, no notable difference in importance of social-emotional motives (i.e., encouragement, affiliation).

Note that the genders do hardly differ in whether or not they are currently active [r(female, active) < -0.02].



<!---
--------------------


<br>
<br>

------------------


# interactions 

```{r, eval=F}
#interaction model


str(io_ml)
m2 <- mlogit(choice ~ prestatie + kennis + gezellig + esteem | female, data = io_ml)
summary(m2)

m2 <- mlogit(choice ~ prestatie + kennis + gezellig + esteem | female, data = io_ml, method = "bhhh")

save(m2,file="./results/io_m2.RData")

mlogit(choice ~ x | z + x:z, data = your_dataset)

```






Test interactions quick 'n dirty: subset data per group and estimate different models

## gender {.tabset .tabset-fade}

### females 

```{r, eval=F}
io_ml_f <- io_ml[which(io_ml$female==1),]
mf <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_f)
save(mf,file="./results/io_m1_females.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_females.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among females in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### males

```{r, eval=F}
io_ml_m <- io_ml[which(io_ml$female==0),]
mm <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_m)
save(mm,file="./results/io_m1_males.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_males.RData")
test <- summary(ans_io)

resm <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resm$vars[1] <- "Comparison: really likes to compare sports performances"
resm$vars[2] <- "Comparison: does not like to compare sports performances"

resm$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resm$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resm$vars[5] <- "Social: exercises for fun and enjoyment"
resm$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resm$vars[7] <- "Encouragement: sometimes encourages you"
resm$vars[8] <- "Encouragement: often encourages you"

names(resm)[1] <- ""

knitr::kable(resm, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among males in I&O panel") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

## {.unlisted .unnumbered}

No difference...



## currently active {.tabset .tabset-fade}

### yes 

```{r, eval=F}
io_ml_active <- io_ml[which(io_ml$activeW2==1),]
ma <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_active)
save(ma,file="./results/io_m1_actives.RData")
```

```{r,class.source = 'fold-hide'}
ans_io <- fload("./results/io_m1_actives.RData")
test <- summary(ans_io)

resf <- as_tibble(round(test$CoefTable, 3), rownames = "vars")
resf$vars[1] <- "Comparison: really likes to compare sports performances"
resf$vars[2] <- "Comparison: does not like to compare sports performances"

resf$vars[3] <- "Knowledge: knows more than you about effective training and the right technique"
resf$vars[4] <- "Knowledge: knows less than you about effective training and the right technique"

resf$vars[5] <- "Social: exercises for fun and enjoyment"
resf$vars[6] <- "Social: wants a combination of joyful and purposeful training"

resf$vars[7] <- "Encouragement: sometimes encourages you"
resf$vars[8] <- "Encouragement: often encourages you"

names(resf)[1] <- ""

knitr::kable(resf, digits=3, "html",  caption="Conditional logit model: preferences for sports partner attributes among I&O panel respondents who are currently active in sports.") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

### no

????

```{r, eval=F}
io_ml_inactive <- io_ml[which(io_ml$activeW2==0),]
mna <- mlogit(choice ~ prestatie + kennis + gezellig + esteem |0, data = io_ml_inactive)

save(mf,file="./results/io_m1_inactives.RData")
```


## {.unlisted .unnumbered}
-->
